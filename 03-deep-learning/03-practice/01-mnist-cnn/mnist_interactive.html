<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNIST CNN äº¤äº’å¼å­¦ä¹ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 10px;
            background: white;
        }

        .canvas-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: center;
        }

        .canvas-wrapper {
            text-align: center;
        }

        .canvas-label {
            margin-top: 10px;
            font-weight: bold;
            color: #667eea;
        }

        .control-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .slider-group {
            margin: 15px 0;
        }

        .slider-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            margin-left: 10px;
            font-weight: bold;
        }

        button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            margin: 5px;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border-color: #667eea;
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .drawing-canvas {
            border: 3px solid #667eea;
            cursor: crosshair;
            touch-action: none;
        }

        .architecture-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
        }

        .layer-box {
            display: inline-block;
            padding: 20px;
            margin: 10px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .conv-layer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .pool-layer {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .fc-layer {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .arrow {
            display: inline-block;
            font-size: 30px;
            margin: 0 10px;
            color: #667eea;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }

        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  MNIST CNN äº¤äº’å¼å­¦ä¹ </h1>

        <!-- Tab Navigation -->
        <div class="section">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('data')">ğŸ“Š ç†è§£æ•°æ®</button>
                <button class="tab-btn" onclick="showTab('conv')">ğŸ” å·ç§¯æ“ä½œ</button>
                <button class="tab-btn" onclick="showTab('model')">ğŸ—ï¸ æ¨¡å‹ç»“æ„</button>
                <button class="tab-btn" onclick="showTab('training')">ğŸ¯ è®­ç»ƒè¿‡ç¨‹</button>
                <button class="tab-btn" onclick="showTab('draw')">âœï¸ æ‰‹å†™æµ‹è¯•</button>
            </div>
        </div>

        <!-- Tab 1: ç†è§£æ•°æ® -->
        <div id="data" class="tab-content active">
            <div class="section">
                <h2>ğŸ“Š ç¬¬1æ­¥ï¼šç†è§£ MNIST æ•°æ®</h2>

                <div class="info-box">
                    <strong>MNIST æ•°æ®é›†ï¼š</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>60,000 å¼ è®­ç»ƒå›¾ç‰‡ + 10,000 å¼ æµ‹è¯•å›¾ç‰‡</li>
                        <li>æ¯å¼ å›¾ç‰‡ 28Ã—28 åƒç´ ï¼Œç°åº¦å›¾ï¼ˆå•é€šé“ï¼‰</li>
                        <li>10 ä¸ªç±»åˆ«ï¼šæ•°å­— 0-9</li>
                    </ul>
                </div>

                <h3 style="margin-top: 30px;">éšæœºæ˜¾ç¤º MNIST å›¾ç‰‡ï¼š</h3>
                <div class="canvas-container" id="mnistSamples"></div>
                <button onclick="generateMNISTSamples()">ğŸ”„ é‡æ–°ç”Ÿæˆéšæœºæ ·æœ¬</button>

                <h3 style="margin-top: 30px;">æŸ¥çœ‹åƒç´ å€¼ï¼š</h3>
                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="pixelCanvas" width="280" height="280"></canvas>
                        <div class="canvas-label">å›¾ç‰‡ï¼ˆæ”¾å¤§10å€ï¼‰</div>
                    </div>
                    <div class="canvas-wrapper">
                        <div id="pixelValues" style="font-family: monospace; font-size: 10px; background: #f4f4f4; padding: 10px; border-radius: 5px; max-width: 400px; overflow: auto;"></div>
                        <div class="canvas-label">åƒç´ å€¼çŸ©é˜µï¼ˆä¸­é—´åŒºåŸŸ5Ã—5ï¼‰</div>
                    </div>
                </div>

                <div class="success-box" style="margin-top: 20px;">
                    <strong>å…³é”®ç†è§£ï¼š</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><code>(1, 28, 28)</code> = (é€šé“, é«˜åº¦, å®½åº¦)</li>
                        <li>åƒç´ å€¼èŒƒå›´ï¼š0.0ï¼ˆé»‘è‰²ï¼‰åˆ° 1.0ï¼ˆç™½è‰²ï¼‰</li>
                        <li>æ‰¹æ¬¡æ•°æ®ï¼š<code>(64, 1, 28, 28)</code> = 64å¼ å›¾ç‰‡ä¸€èµ·å¤„ç†</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tab 2: å·ç§¯æ“ä½œ -->
        <div id="conv" class="tab-content">
            <div class="section">
                <h2>ğŸ” ç¬¬2æ­¥ï¼šç†è§£å·ç§¯æ“ä½œ</h2>

                <div class="info-box">
                    <strong>å·ç§¯çš„æœ¬è´¨ï¼š</strong> ç”¨ä¸€ä¸ªå°çª—å£ï¼ˆæ»¤æ³¢å™¨ï¼‰åœ¨å›¾ç‰‡ä¸Šæ»‘åŠ¨ï¼Œæå–ç‰¹å¾ã€‚
                </div>

                <div class="control-panel">
                    <h3>è°ƒæ•´æ»¤æ³¢å™¨å‚æ•°ï¼š</h3>
                    <div class="slider-group">
                        <label>æ»¤æ³¢å™¨ç±»å‹ï¼š</label>
                        <select id="filterType" onchange="applyConvolution()" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="edge_vertical">å‚ç›´è¾¹ç¼˜æ£€æµ‹</option>
                            <option value="edge_horizontal">æ°´å¹³è¾¹ç¼˜æ£€æµ‹</option>
                            <option value="edge_all">å…¨è¾¹ç¼˜æ£€æµ‹</option>
                            <option value="blur">æ¨¡ç³Š</option>
                            <option value="sharpen">é”åŒ–</option>
                        </select>
                    </div>
                </div>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="inputImage" width="280" height="280"></canvas>
                        <div class="canvas-label">è¾“å…¥å›¾ç‰‡ (28Ã—28)</div>
                    </div>
                    <div class="canvas-wrapper">
                        <div style="font-size: 40px; color: #667eea;">â†’</div>
                    </div>
                    <div class="canvas-wrapper">
                        <div id="filterDisplay" style="background: #f4f4f4; padding: 15px; border-radius: 8px; font-family: monospace;">
                            <!-- æ»¤æ³¢å™¨çŸ©é˜µ -->
                        </div>
                        <div class="canvas-label">3Ã—3 æ»¤æ³¢å™¨</div>
                    </div>
                    <div class="canvas-wrapper">
                        <div style="font-size: 40px; color: #667eea;">â†’</div>
                    </div>
                    <div class="canvas-wrapper">
                        <canvas id="outputImage" width="280" height="280"></canvas>
                        <div class="canvas-label">è¾“å‡ºç‰¹å¾å›¾ (28Ã—28)</div>
                    </div>
                </div>

                <div class="warning-box" style="margin-top: 20px;">
                    <strong>å®éªŒï¼š</strong> å°è¯•ä¸åŒçš„æ»¤æ³¢å™¨ç±»å‹ï¼Œè§‚å¯Ÿè¾“å‡ºçš„å˜åŒ–ï¼
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>å‚ç›´è¾¹ç¼˜ï¼š</strong>æ£€æµ‹ç«–ç›´çš„çº¿æ¡ï¼ˆå¦‚æ•°å­—"1"ï¼‰</li>
                        <li><strong>æ°´å¹³è¾¹ç¼˜ï¼š</strong>æ£€æµ‹æ°´å¹³çš„çº¿æ¡ï¼ˆå¦‚æ•°å­—"7"çš„æ¨ªçº¿ï¼‰</li>
                        <li><strong>å…¨è¾¹ç¼˜ï¼š</strong>æ£€æµ‹æ‰€æœ‰æ–¹å‘çš„è¾¹ç¼˜</li>
                    </ul>
                </div>

                <div class="success-box">
                    <strong>å…³é”®ç†è§£ï¼š</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>å·ç§¯ = æ»¤æ³¢å™¨åœ¨å›¾ç‰‡ä¸Šæ»‘åŠ¨ï¼Œé€ä¸ªä½ç½®è®¡ç®—</li>
                        <li>ä¸åŒçš„æ»¤æ³¢å™¨æ£€æµ‹ä¸åŒçš„ç‰¹å¾ï¼ˆè¾¹ç¼˜ã€çº¹ç†ç­‰ï¼‰</li>
                        <li>CNN è®­ç»ƒè¿‡ç¨‹å°±æ˜¯è‡ªåŠ¨å­¦ä¹ æœ€ä¼˜çš„æ»¤æ³¢å™¨å‚æ•°</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tab 3: æ¨¡å‹ç»“æ„ -->
        <div id="model" class="tab-content">
            <div class="section">
                <h2>ğŸ—ï¸ ç¬¬3æ­¥ï¼šCNN æ¨¡å‹ç»“æ„</h2>

                <div class="architecture-diagram">
                    <div style="text-align: center; white-space: nowrap; overflow-x: auto;">
                        <div class="layer-box" style="background: #28a745; color: white;">
                            <strong>è¾“å…¥</strong><br>
                            1Ã—28Ã—28
                        </div>
                        <span class="arrow">â†’</span>
                        <div class="layer-box conv-layer">
                            <strong>Conv1</strong><br>
                            32 æ»¤æ³¢å™¨<br>
                            3Ã—3
                        </div>
                        <span class="arrow">â†’</span>
                        <div class="layer-box pool-layer">
                            <strong>Pool1</strong><br>
                            2Ã—2<br>
                            Max
                        </div>
                        <span class="arrow">â†’</span>
                        <div class="layer-box conv-layer">
                            <strong>Conv2</strong><br>
                            64 æ»¤æ³¢å™¨<br>
                            3Ã—3
                        </div>
                        <span class="arrow">â†’</span>
                        <div class="layer-box pool-layer">
                            <strong>Pool2</strong><br>
                            2Ã—2<br>
                            Max
                        </div>
                        <span class="arrow">â†’</span>
                        <div class="layer-box fc-layer">
                            <strong>FC1</strong><br>
                            128<br>
                            ç¥ç»å…ƒ
                        </div>
                        <span class="arrow">â†’</span>
                        <div class="layer-box fc-layer">
                            <strong>FC2</strong><br>
                            10<br>
                            è¾“å‡º
                        </div>
                    </div>
                </div>

                <div class="grid-container" style="margin-top: 30px;">
                    <div class="card">
                        <h3>ğŸ“ å½¢çŠ¶å˜åŒ–</h3>
                        <pre>
è¾“å…¥:  1Ã—28Ã—28
Conv1: 32Ã—28Ã—28 â† 32ä¸ªæ»¤æ³¢å™¨
Pool1: 32Ã—14Ã—14 â† æ± åŒ–å‹ç¼©
Conv2: 64Ã—14Ã—14 â† 64ä¸ªæ»¤æ³¢å™¨
Pool2: 64Ã—7Ã—7   â† å†æ¬¡å‹ç¼©
å±•å¹³:  3136     â† 64Ã—7Ã—7=3136
FC1:   128      â† å…¨è¿æ¥
FC2:   10       â† 10ä¸ªç±»åˆ«
                        </pre>
                    </div>

                    <div class="card">
                        <h3>ğŸ”¢ å‚æ•°é‡</h3>
                        <pre>
Conv1: 3Ã—3Ã—1Ã—32 = 288
Conv2: 3Ã—3Ã—32Ã—64 = 18,432
FC1: 3136Ã—128 = 401,408
FC2: 128Ã—10 = 1,280

<strong>æ€»è®¡: 421,642 å‚æ•°</strong>

æ³¨æ„ï¼šå…¨è¿æ¥å±‚å 95%ï¼
                        </pre>
                    </div>

                    <div class="card">
                        <h3>ğŸ¯ æ¯å±‚ä½œç”¨</h3>
                        <ul style="margin-left: 20px;">
                            <li><strong>Conv1:</strong> æå–ä½çº§ç‰¹å¾ï¼ˆè¾¹ç¼˜ï¼‰</li>
                            <li><strong>Pool1:</strong> å‹ç¼©ç©ºé—´ï¼Œæ‰©å¤§è§†é‡</li>
                            <li><strong>Conv2:</strong> æå–é«˜çº§ç‰¹å¾ï¼ˆå½¢çŠ¶ï¼‰</li>
                            <li><strong>Pool2:</strong> ç»§ç»­å‹ç¼©</li>
                            <li><strong>FC:</strong> ç»¼åˆç‰¹å¾ï¼Œåˆ†ç±»å†³ç­–</li>
                        </ul>
                    </div>
                </div>

                <div class="info-box">
                    <strong>è®¾è®¡åŸåˆ™ï¼š</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>ç©ºé—´ç»´åº¦é€æ¸ç¼©å°ï¼š28 â†’ 14 â†’ 7</li>
                        <li>ç‰¹å¾é€šé“é€æ¸å¢å¤šï¼š1 â†’ 32 â†’ 64</li>
                        <li>å‰åŠæ®µæå–ç‰¹å¾ï¼ŒååŠæ®µåˆ†ç±»å†³ç­–</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tab 4: è®­ç»ƒè¿‡ç¨‹ -->
        <div id="training" class="tab-content">
            <div class="section">
                <h2>ğŸ¯ ç¬¬4æ­¥ï¼šè®­ç»ƒè¿‡ç¨‹å¯è§†åŒ–</h2>

                <div class="info-box">
                    <strong>è®­ç»ƒæµç¨‹ï¼š</strong> å‰å‘ä¼ æ’­ â†’ è®¡ç®—æŸå¤± â†’ åå‘ä¼ æ’­ â†’ æ›´æ–°æƒé‡
                </div>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="lossChart" width="500" height="300"></canvas>
                        <div class="canvas-label">æŸå¤±å‡½æ•°æ›²çº¿</div>
                    </div>
                    <div class="canvas-wrapper">
                        <canvas id="accuracyChart" width="500" height="300"></canvas>
                        <div class="canvas-label">å‡†ç¡®ç‡æ›²çº¿</div>
                    </div>
                </div>

                <div class="control-panel">
                    <h3>æ¨¡æ‹Ÿè®­ç»ƒï¼š</h3>
                    <button onclick="startTraining()">â–¶ï¸ å¼€å§‹è®­ç»ƒ</button>
                    <button onclick="pauseTraining()">â¸ï¸ æš‚åœ</button>
                    <button onclick="resetTraining()">ğŸ”„ é‡ç½®</button>
                    <div id="trainingStatus" style="margin-top: 15px; font-size: 18px; font-weight: bold;"></div>
                </div>

                <div class="grid-container" style="margin-top: 30px;">
                    <div class="card">
                        <h3>ğŸ”„ è®­ç»ƒå¾ªç¯</h3>
                        <pre>
for epoch in range(5):
    for images, labels in train_loader:
        # 1. å‰å‘ä¼ æ’­
        outputs = model(images)
        loss = criterion(outputs, labels)

        # 2. åå‘ä¼ æ’­
        optimizer.zero_grad()
        loss.backward()
        optimizer.step()
                        </pre>
                    </div>

                    <div class="card">
                        <h3>ğŸ“‰ æŸå¤±å‡½æ•°</h3>
                        <p><strong>äº¤å‰ç†µæŸå¤±ï¼ˆCross Entropyï¼‰</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>è¡¡é‡é¢„æµ‹å’ŒçœŸå®æ ‡ç­¾çš„å·®è·</li>
                            <li>æŸå¤±è¶Šå°ï¼Œé¢„æµ‹è¶Šå‡†ç¡®</li>
                            <li>è®­ç»ƒç›®æ ‡ï¼šæœ€å°åŒ–æŸå¤±</li>
                        </ul>
                    </div>

                    <div class="card">
                        <h3>ğŸ“ ä¼˜åŒ–å™¨</h3>
                        <p><strong>Adam ä¼˜åŒ–å™¨</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>è‡ªåŠ¨è°ƒæ•´å­¦ä¹ ç‡</li>
                            <li>æ¯” SGD æ”¶æ•›æ›´å¿«</li>
                            <li>æœ€å¸¸ç”¨çš„ä¼˜åŒ–å™¨</li>
                        </ul>
                    </div>
                </div>

                <div class="success-box">
                    <strong>è®­ç»ƒç»“æœï¼š</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>5 ä¸ª epoch åå‡†ç¡®ç‡è¾¾åˆ° <strong>99%+</strong></li>
                        <li>è®­ç»ƒæ—¶é—´ï¼šçº¦ 3-5 åˆ†é’Ÿï¼ˆCPUï¼‰</li>
                        <li>æµ‹è¯•å‡†ç¡®ç‡æ¥è¿‘è®­ç»ƒå‡†ç¡®ç‡ â†’ æ²¡æœ‰è¿‡æ‹Ÿåˆ</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tab 5: æ‰‹å†™æµ‹è¯• -->
        <div id="draw" class="tab-content">
            <div class="section">
                <h2>âœï¸ ç¬¬5æ­¥ï¼šæ‰‹å†™æ•°å­—æµ‹è¯•</h2>

                <div class="info-box">
                    <strong>è¯•è¯•çœ‹ï¼š</strong> åœ¨ç”»å¸ƒä¸Šå†™ä¸€ä¸ªæ•°å­—ï¼Œçœ‹çœ‹æ¨¡å‹èƒ½å¦è¯†åˆ«ï¼
                </div>

                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="drawCanvas" width="280" height="280" class="drawing-canvas"></canvas>
                        <div class="canvas-label">åœ¨è¿™é‡Œå†™æ•°å­—ï¼ˆ0-9ï¼‰</div>
                    </div>
                    <div class="canvas-wrapper">
                        <canvas id="processedCanvas" width="280" height="280"></canvas>
                        <div class="canvas-label">å¤„ç†åçš„å›¾ç‰‡ï¼ˆ28Ã—28ï¼‰</div>
                    </div>
                    <div class="canvas-wrapper">
                        <div id="prediction" style="text-align: center; font-size: 80px; font-weight: bold; color: #667eea; padding: 50px;">
                            ?
                        </div>
                        <div class="canvas-label">æ¨¡å‹é¢„æµ‹ç»“æœ</div>
                    </div>
                </div>

                <div style="text-align: center; margin: 20px 0;">
                    <button onclick="clearDrawing()">ğŸ—‘ï¸ æ¸…ç©ºç”»å¸ƒ</button>
                    <button onclick="recognizeDigit()">ğŸ” è¯†åˆ«æ•°å­—</button>
                </div>

                <div class="warning-box">
                    <strong>æ³¨æ„ï¼š</strong> è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„è¯†åˆ«æ¼”ç¤ºã€‚çœŸå®çš„ CNN æ¨¡å‹éœ€è¦åœ¨ Python ä¸­è®­ç»ƒï¼Œç„¶åæ‰èƒ½è¿›è¡Œå‡†ç¡®çš„é¢„æµ‹ã€‚è¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿçš„è¯†åˆ«ç»“æœæ¥å¸®åŠ©æ‚¨ç†è§£å·¥ä½œæµç¨‹ã€‚
                </div>

                <div id="predictionDetails" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px; display: none;">
                    <h3>é¢„æµ‹è¯¦æƒ…ï¼š</h3>
                    <canvas id="probabilityChart" width="500" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // å…¨å±€å˜é‡
        // ============================================
        let trainingInterval = null;
        let currentEpoch = 0;
        let trainingData = {
            loss: [],
            accuracy: []
        };

        // ============================================
        // Tab åˆ‡æ¢
        // ============================================
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // åˆå§‹åŒ–å¯¹åº”çš„å†…å®¹
            if (tabName === 'data') {
                generateMNISTSamples();
            } else if (tabName === 'conv') {
                applyConvolution();
            }
        }

        // ============================================
        // Tab 1: ç”Ÿæˆ MNIST æ ·æœ¬
        // ============================================
        function generateMNISTSamples() {
            const container = document.getElementById('mnistSamples');
            container.innerHTML = '';

            for (let i = 0; i < 10; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = 'canvas-wrapper';

                const canvas = document.createElement('canvas');
                canvas.width = 84;
                canvas.height = 84;
                const ctx = canvas.getContext('2d');

                // ç”Ÿæˆéšæœºæ•°å­—å›¾åƒ
                const digit = Math.floor(Math.random() * 10);
                drawDigit(ctx, digit, 84);

                const label = document.createElement('div');
                label.className = 'canvas-label';
                label.textContent = `æ•°å­—: ${digit}`;

                wrapper.appendChild(canvas);
                wrapper.appendChild(label);
                container.appendChild(wrapper);
            }

            // æ›´æ–°åƒç´ å€¼æ˜¾ç¤º
            updatePixelDisplay();
        }

        function drawDigit(ctx, digit, size) {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, size, size);
            ctx.fillStyle = 'white';
            ctx.font = `bold ${size * 0.7}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(digit, size / 2, size / 2);
        }

        function updatePixelDisplay() {
            const canvas = document.getElementById('pixelCanvas');
            const ctx = canvas.getContext('2d');

            // ç»˜åˆ¶ä¸€ä¸ªæ•°å­—
            drawDigit(ctx, 5, 280);

            // æ˜¾ç¤ºä¸­é—´åŒºåŸŸ5Ã—5åƒç´ å€¼ï¼ˆä¸æ˜¯å·¦ä¸Šè§’ï¼ï¼‰
            const imageData = ctx.getImageData(0, 0, 28, 28);

            // ä»ç¬¬10è¡Œã€ç¬¬10åˆ—å¼€å§‹ï¼ˆä¸­é—´æœ‰æ•°å­—çš„åŒºåŸŸï¼‰
            const startRow = 10;
            const startCol = 10;

            let html = '<div style="margin-bottom: 10px; color: #667eea; font-weight: bold;">ä¸­é—´åŒºåŸŸ (10-14è¡Œ, 10-14åˆ—)</div>';
            html += '<table style="border-collapse: collapse;">';

            for (let i = 0; i < 5; i++) {
                html += '<tr>';
                for (let j = 0; j < 5; j++) {
                    const row = startRow + i;
                    const col = startCol + j;
                    const idx = (row * 28 + col) * 4;
                    const value = (imageData.data[idx] / 255).toFixed(2);

                    // æ ¹æ®åƒç´ å€¼è®¾ç½®èƒŒæ™¯è‰²
                    const brightness = Math.floor(imageData.data[idx]);
                    const bgColor = `rgb(${brightness}, ${brightness}, ${brightness})`;
                    const textColor = brightness > 127 ? 'black' : 'white';

                    html += `<td style="padding: 8px; border: 1px solid #ddd; background: ${bgColor}; color: ${textColor}; font-weight: bold;">${value}</td>`;
                }
                html += '</tr>';
            }
            html += '</table>';

            html += '<div style="margin-top: 10px; font-size: 12px; color: #666;">';
            html += 'ğŸ’¡ <strong>æç¤ºï¼š</strong>å·¦ä¸Šè§’éƒ½æ˜¯0ï¼ˆèƒŒæ™¯ï¼‰ï¼Œæ‰€ä»¥æ˜¾ç¤ºä¸­é—´æœ‰æ•°å­—çš„åŒºåŸŸ<br>';
            html += '0.0 = é»‘è‰²èƒŒæ™¯ï¼Œ1.0 = ç™½è‰²æ•°å­—';
            html += '</div>';

            document.getElementById('pixelValues').innerHTML = html;
        }

        // ============================================
        // Tab 2: å·ç§¯æ“ä½œ
        // ============================================
        function applyConvolution() {
            const inputCanvas = document.getElementById('inputImage');
            const outputCanvas = document.getElementById('outputImage');
            const inputCtx = inputCanvas.getContext('2d');
            const outputCtx = outputCanvas.getContext('2d');

            // ç»˜åˆ¶è¾“å…¥å›¾åƒ
            drawDigit(inputCtx, 7, 280);

            // è·å–æ»¤æ³¢å™¨
            const filterType = document.getElementById('filterType').value;
            const filter = getFilter(filterType);

            // æ˜¾ç¤ºæ»¤æ³¢å™¨
            displayFilter(filter);

            // åº”ç”¨å·ç§¯ï¼ˆç®€åŒ–ç‰ˆï¼‰
            const inputData = inputCtx.getImageData(0, 0, 280, 280);
            const outputData = outputCtx.createImageData(280, 280);

            // ç®€åŒ–çš„å·ç§¯æ“ä½œ
            for (let y = 1; y < 279; y++) {
                for (let x = 1; x < 279; x++) {
                    let sum = 0;
                    for (let fy = -1; fy <= 1; fy++) {
                        for (let fx = -1; fx <= 1; fx++) {
                            const idx = ((y + fy) * 280 + (x + fx)) * 4;
                            const pixel = inputData.data[idx];
                            sum += pixel * filter[fy + 1][fx + 1];
                        }
                    }
                    sum = Math.abs(sum);
                    sum = Math.min(255, Math.max(0, sum));

                    const outIdx = (y * 280 + x) * 4;
                    outputData.data[outIdx] = sum;
                    outputData.data[outIdx + 1] = sum;
                    outputData.data[outIdx + 2] = sum;
                    outputData.data[outIdx + 3] = 255;
                }
            }

            outputCtx.putImageData(outputData, 0, 0);
        }

        function getFilter(type) {
            const filters = {
                edge_vertical: [
                    [-1, 0, 1],
                    [-2, 0, 2],
                    [-1, 0, 1]
                ],
                edge_horizontal: [
                    [-1, -2, -1],
                    [0, 0, 0],
                    [1, 2, 1]
                ],
                edge_all: [
                    [-1, -1, -1],
                    [-1, 8, -1],
                    [-1, -1, -1]
                ],
                blur: [
                    [1/9, 1/9, 1/9],
                    [1/9, 1/9, 1/9],
                    [1/9, 1/9, 1/9]
                ],
                sharpen: [
                    [0, -1, 0],
                    [-1, 5, -1],
                    [0, -1, 0]
                ]
            };
            return filters[type];
        }

        function displayFilter(filter) {
            let html = '<table style="border-collapse: collapse; margin: 0 auto;">';
            for (let i = 0; i < 3; i++) {
                html += '<tr>';
                for (let j = 0; j < 3; j++) {
                    const value = filter[i][j].toFixed(2);
                    html += `<td style="padding: 10px; border: 2px solid #667eea; text-align: center; font-weight: bold; color: #667eea;">${value}</td>`;
                }
                html += '</tr>';
            }
            html += '</table>';
            document.getElementById('filterDisplay').innerHTML = html;
        }

        // ============================================
        // Tab 4: è®­ç»ƒè¿‡ç¨‹æ¨¡æ‹Ÿ
        // ============================================
        function startTraining() {
            if (trainingInterval) return;

            trainingInterval = setInterval(() => {
                if (currentEpoch >= 50) {
                    pauseTraining();
                    return;
                }

                // æ¨¡æ‹Ÿè®­ç»ƒæ•°æ®
                currentEpoch++;
                const loss = 2.0 * Math.exp(-currentEpoch / 10) + 0.1 + Math.random() * 0.1;
                const accuracy = 100 * (1 - Math.exp(-currentEpoch / 10)) + Math.random() * 2;

                trainingData.loss.push(loss);
                trainingData.accuracy.push(accuracy);

                // æ›´æ–°å›¾è¡¨
                drawLossChart();
                drawAccuracyChart();

                // æ›´æ–°çŠ¶æ€
                document.getElementById('trainingStatus').innerHTML = `
                    Epoch ${currentEpoch}/50 |
                    Loss: ${loss.toFixed(4)} |
                    Accuracy: ${accuracy.toFixed(2)}%
                `;
            }, 100);
        }

        function pauseTraining() {
            if (trainingInterval) {
                clearInterval(trainingInterval);
                trainingInterval = null;
            }
        }

        function resetTraining() {
            pauseTraining();
            currentEpoch = 0;
            trainingData = { loss: [], accuracy: [] };
            drawLossChart();
            drawAccuracyChart();
            document.getElementById('trainingStatus').innerHTML = '';
        }

        function drawLossChart() {
            const canvas = document.getElementById('lossChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 250);
            ctx.lineTo(450, 250);
            ctx.lineTo(450, 50);
            ctx.stroke();

            // ç»˜åˆ¶æ ‡ç­¾
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.fillText('Loss', 10, 30);
            ctx.fillText('Epoch', 420, 280);

            // ç»˜åˆ¶æ•°æ®
            if (trainingData.loss.length > 1) {
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 3;
                ctx.beginPath();

                for (let i = 0; i < trainingData.loss.length; i++) {
                    const x = 50 + (i / 50) * 400;
                    const y = 250 - (trainingData.loss[i] / 2.5) * 200;
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
        }

        function drawAccuracyChart() {
            const canvas = document.getElementById('accuracyChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 250);
            ctx.lineTo(450, 250);
            ctx.lineTo(450, 50);
            ctx.stroke();

            // ç»˜åˆ¶æ ‡ç­¾
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.fillText('Accuracy (%)', 10, 30);
            ctx.fillText('Epoch', 420, 280);

            // ç»˜åˆ¶æ•°æ®
            if (trainingData.accuracy.length > 1) {
                ctx.strokeStyle = '#27ae60';
                ctx.lineWidth = 3;
                ctx.beginPath();

                for (let i = 0; i < trainingData.accuracy.length; i++) {
                    const x = 50 + (i / 50) * 400;
                    const y = 250 - (trainingData.accuracy[i] / 100) * 200;
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
        }

        // ============================================
        // Tab 5: æ‰‹å†™è¯†åˆ«
        // ============================================
        let isDrawing = false;
        let drawCanvas, drawCtx;

        function initDrawing() {
            drawCanvas = document.getElementById('drawCanvas');
            drawCtx = drawCanvas.getContext('2d');

            drawCtx.fillStyle = 'black';
            drawCtx.fillRect(0, 0, 280, 280);
            drawCtx.strokeStyle = 'white';
            drawCtx.lineWidth = 20;
            drawCtx.lineCap = 'round';
            drawCtx.lineJoin = 'round';

            drawCanvas.addEventListener('mousedown', startDraw);
            drawCanvas.addEventListener('mousemove', draw);
            drawCanvas.addEventListener('mouseup', stopDraw);
            drawCanvas.addEventListener('mouseout', stopDraw);

            // è§¦æ‘¸æ”¯æŒ
            drawCanvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = drawCanvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                drawCtx.beginPath();
                drawCtx.moveTo(x, y);
                isDrawing = true;
            });

            drawCanvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!isDrawing) return;
                const touch = e.touches[0];
                const rect = drawCanvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                drawCtx.lineTo(x, y);
                drawCtx.stroke();
            });

            drawCanvas.addEventListener('touchend', () => {
                isDrawing = false;
            });
        }

        function startDraw(e) {
            isDrawing = true;
            const rect = drawCanvas.getBoundingClientRect();
            drawCtx.beginPath();
            drawCtx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = drawCanvas.getBoundingClientRect();
            drawCtx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            drawCtx.stroke();
        }

        function stopDraw() {
            isDrawing = false;
        }

        function clearDrawing() {
            drawCtx.fillStyle = 'black';
            drawCtx.fillRect(0, 0, 280, 280);
            document.getElementById('prediction').textContent = '?';
            document.getElementById('predictionDetails').style.display = 'none';
        }

        function recognizeDigit() {
            // ç¼©å°åˆ°28Ã—28
            const processedCanvas = document.getElementById('processedCanvas');
            const processedCtx = processedCanvas.getContext('2d');
            processedCtx.drawImage(drawCanvas, 0, 0, 280, 280, 0, 0, 280, 280);

            // æ¨¡æ‹Ÿè¯†åˆ«ï¼ˆå®é™…éœ€è¦åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹ï¼‰
            const prediction = Math.floor(Math.random() * 10);
            document.getElementById('prediction').textContent = prediction;

            // æ˜¾ç¤ºé¢„æµ‹è¯¦æƒ…
            document.getElementById('predictionDetails').style.display = 'block';
            drawProbabilityChart(prediction);
        }

        function drawProbabilityChart(predicted) {
            const canvas = document.getElementById('probabilityChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç”Ÿæˆæ¨¡æ‹Ÿæ¦‚ç‡
            const probabilities = [];
            for (let i = 0; i < 10; i++) {
                if (i === predicted) {
                    probabilities.push(0.8 + Math.random() * 0.15);
                } else {
                    probabilities.push(Math.random() * 0.1);
                }
            }

            // å½’ä¸€åŒ–
            const sum = probabilities.reduce((a, b) => a + b, 0);
            for (let i = 0; i < 10; i++) {
                probabilities[i] /= sum;
            }

            // ç»˜åˆ¶æŸ±çŠ¶å›¾
            const barWidth = 40;
            const gap = 10;
            const startX = 50;

            for (let i = 0; i < 10; i++) {
                const x = startX + i * (barWidth + gap);
                const height = probabilities[i] * 200;
                const y = 250 - height;

                ctx.fillStyle = i === predicted ? '#667eea' : '#ddd';
                ctx.fillRect(x, y, barWidth, height);

                // æ ‡ç­¾
                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(i, x + barWidth / 2, 275);

                // æ¦‚ç‡å€¼
                ctx.font = '10px Arial';
                ctx.fillText((probabilities[i] * 100).toFixed(1) + '%', x + barWidth / 2, y - 5);
            }
        }

        // ============================================
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        // ============================================
        window.onload = function() {
            generateMNISTSamples();
            initDrawing();
        };
    </script>
</body>
</html>
