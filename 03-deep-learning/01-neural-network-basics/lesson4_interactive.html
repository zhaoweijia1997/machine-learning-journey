<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬4è¯¾ï¼šæ¢¯åº¦ä¸‹é™ - äº¤äº’å¼æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
            background: linear-gradient(90deg, #f093fb, #f5576c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h2 {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #f5576c;
        }

        /* ç”»å¸ƒ */
        #lossCanvas {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            display: block;
            margin: 0 auto;
        }

        /* æ§åˆ¶åŒº */
        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .slider-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #f5576c;
            cursor: pointer;
        }

        .value-display {
            min-width: 50px;
            text-align: right;
            font-family: monospace;
            color: #f093fb;
        }

        /* æŒ‰é’® */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-step {
            background: linear-gradient(90deg, #f093fb, #f5576c);
            color: #fff;
        }

        .btn-auto {
            background: linear-gradient(90deg, #11998e, #38ef7d);
            color: #fff;
        }

        .btn-reset {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* çŠ¶æ€æ˜¾ç¤º */
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .status-label {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.5em;
            font-family: monospace;
            font-weight: bold;
        }

        .status-value.weight {
            color: #f093fb;
        }

        .status-value.loss {
            color: #f5576c;
        }

        .status-value.gradient {
            color: #38ef7d;
        }

        .status-value.step {
            color: #ffd93d;
        }

        /* å†å²è®°å½• */
        .history {
            max-height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85em;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .history-item {
            padding: 3px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        /* è¯´æ˜åŒº */
        .explanation {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            margin: 15px 0;
            line-height: 2;
        }

        .key-point {
            background: rgba(245, 87, 108, 0.1);
            border-left: 3px solid #f5576c;
            padding: 15px;
            margin: 15px 0;
        }

        .explanation h3 {
            color: #f5576c;
            margin-bottom: 15px;
        }

        .explanation p {
            line-height: 1.8;
            color: #ccc;
            margin-bottom: 10px;
        }

        /* é—®é¢˜è®¾å®š */
        .problem-box {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .problem-box code {
            color: #f093fb;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“‰ ç¬¬4è¯¾ï¼šæ¢¯åº¦ä¸‹é™</h1>
        <p class="subtitle">çœ‹ç€æƒé‡ä¸€æ­¥æ­¥æ‰¾åˆ°æœ€ä¼˜å€¼</p>

        <div class="main-grid">
            <!-- å·¦ä¾§ï¼šå¯è§†åŒ– -->
            <div class="panel">
                <h2>ğŸ“ˆ æŸå¤±æ›²çº¿</h2>
                <canvas id="lossCanvas" width="450" height="300"></canvas>

                <div class="problem-box">
                    <strong>é—®é¢˜è®¾å®šï¼š</strong><br>
                    è¾“å…¥ <code>x = 2</code>ï¼ŒçœŸå®ç­”æ¡ˆ <code>y = 2</code><br>
                    é¢„æµ‹å…¬å¼ï¼š<code>y = x Ã— w</code><br>
                    æœ€ä¼˜æƒé‡ï¼š<code>w = 1</code>ï¼ˆå› ä¸º 2Ã—1=2ï¼‰
                </div>
            </div>

            <!-- å³ä¾§ï¼šæ§åˆ¶å’ŒçŠ¶æ€ -->
            <div class="panel">
                <h2>ğŸ›ï¸ è®­ç»ƒæ§åˆ¶</h2>

                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">å½“å‰æƒé‡ w</div>
                        <div class="status-value weight" id="currentW">0.00</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">æŸå¤±å€¼</div>
                        <div class="status-value loss" id="currentLoss">4.00</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">æ¢¯åº¦</div>
                        <div class="status-value gradient" id="currentGrad">-8.00</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">è®­ç»ƒè½®æ¬¡</div>
                        <div class="status-value step" id="currentStep">0</div>
                    </div>
                </div>

                <div class="control-group">
                    <label>ğŸ¯ åˆå§‹æƒé‡ wâ‚€</label>
                    <div class="slider-row">
                        <input type="range" id="initW" min="-2" max="4" step="0.1" value="0">
                        <span class="value-display" id="initWValue">0.0</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>ğŸ“ å­¦ä¹ ç‡ (Learning Rate)</label>
                    <div class="slider-row">
                        <input type="range" id="lr" min="0.01" max="0.3" step="0.01" value="0.1">
                        <span class="value-display" id="lrValue">0.10</span>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-step" onclick="step()">â–¶ å•æ­¥</button>
                    <button class="btn btn-auto" id="autoBtn" onclick="toggleAuto()">â© è‡ªåŠ¨</button>
                    <button class="btn btn-reset" onclick="reset()">ğŸ”„ é‡ç½®</button>
                </div>

                <div class="history" id="history">
                    <div style="color:#888;">è®­ç»ƒå†å²å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
                </div>
            </div>

            <!-- è¯´æ˜åŒº -->
            <div class="panel explanation">
                <h3>ğŸ’¡ ç†è§£æ¢¯åº¦ä¸‹é™</h3>

                <div class="formula-box">
                    <strong>æ ¸å¿ƒå…¬å¼ï¼š</strong><br><br>
                    æ¢¯åº¦ = âˆ‚Loss/âˆ‚w = 2 Ã— (é¢„æµ‹ - çœŸå®) Ã— è¾“å…¥<br><br>
                    æ–°æƒé‡ = æ—§æƒé‡ - å­¦ä¹ ç‡ Ã— æ¢¯åº¦
                </div>

                <div class="key-point">
                    <strong>ä¸ºä»€ä¹ˆæ˜¯"å‡"æ¢¯åº¦ï¼Ÿ</strong><br>
                    æ¢¯åº¦æŒ‡å‘æŸå¤±<b>å¢å¤§</b>çš„æ–¹å‘ã€‚æˆ‘ä»¬è¦è®©æŸå¤±<b>å‡å°</b>ï¼Œæ‰€ä»¥è¦å¾€<b>åæ–¹å‘</b>èµ°ï¼
                </div>

                <p><strong>è§‚å¯Ÿå®éªŒï¼š</strong></p>
                <ul style="margin-left: 20px; line-height: 2; color: #ccc;">
                    <li>è°ƒå°å­¦ä¹ ç‡(0.01)ï¼šæ”¶æ•›æ…¢ï¼Œä½†ç¨³å®š</li>
                    <li>è°ƒå¤§å­¦ä¹ ç‡(0.25)ï¼šæ”¶æ•›å¿«ï¼Œä½†å¯èƒ½éœ‡è¡</li>
                    <li>å­¦ä¹ ç‡å¤ªå¤§(>0.25)ï¼šå¯èƒ½å‘æ•£ï¼</li>
                </ul>

                <p style="margin-top: 15px;">
                    <strong>æ€è€ƒï¼š</strong>æ›²çº¿ä¸Šçš„çº¢ç‚¹å°±æ˜¯å½“å‰ä½ç½®ï¼Œæ¯ä¸€æ­¥éƒ½åœ¨å¾€"è°·åº•"èµ°ã€‚
                    è¿™å°±æ˜¯"ä¸‹å±±"çš„è¿‡ç¨‹â€”â€”æ¢¯åº¦ä¸‹é™ï¼
                </p>
            </div>
        </div>
    </div>

    <script>
        // é—®é¢˜è®¾å®š
        const x = 2;
        const y_true = 2;

        // çŠ¶æ€
        let w = 0;
        let stepCount = 0;
        let autoRunning = false;
        let autoInterval = null;
        let history = [];

        // è®¡ç®—æŸå¤±
        function loss(w) {
            const y_pred = x * w;
            return Math.pow(y_pred - y_true, 2);
        }

        // è®¡ç®—æ¢¯åº¦
        function gradient(w) {
            const y_pred = x * w;
            return 2 * (y_pred - y_true) * x;
        }

        // ç»˜åˆ¶æŸå¤±æ›²çº¿
        function drawLossCurve() {
            const canvas = document.getElementById('lossCanvas');
            const ctx = canvas.getContext('2d');
            const W = canvas.width;
            const H = canvas.height;

            ctx.clearRect(0, 0, W, H);

            // åæ ‡èŒƒå›´
            const wMin = -1, wMax = 3;
            const lossMax = 10;

            // è½¬æ¢å‡½æ•°
            const toX = (w) => (w - wMin) / (wMax - wMin) * (W - 60) + 40;
            const toY = (l) => H - 40 - (l / lossMax) * (H - 60);

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(40, 20);
            ctx.lineTo(40, H - 40);
            ctx.lineTo(W - 20, H - 40);
            ctx.stroke();

            // åæ ‡æ ‡ç­¾
            ctx.fillStyle = '#888';
            ctx.font = '12px monospace';
            ctx.textAlign = 'center';

            // X è½´æ ‡ç­¾
            for (let i = 0; i <= 4; i++) {
                const wVal = wMin + i * (wMax - wMin) / 4;
                ctx.fillText(wVal.toFixed(1), toX(wVal), H - 25);
            }
            ctx.fillText('w', W - 10, H - 25);

            // Y è½´æ ‡ç­¾
            ctx.textAlign = 'right';
            for (let i = 0; i <= 4; i++) {
                const lVal = i * lossMax / 4;
                ctx.fillText(lVal.toFixed(0), 35, toY(lVal) + 4);
            }
            ctx.save();
            ctx.translate(15, H / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('Loss', 0, 0);
            ctx.restore();

            // ç»˜åˆ¶æŸå¤±æ›²çº¿
            ctx.strokeStyle = '#f5576c';
            ctx.lineWidth = 2;
            ctx.beginPath();
            let first = true;
            for (let wVal = wMin; wVal <= wMax; wVal += 0.02) {
                const l = loss(wVal);
                if (l <= lossMax) {
                    if (first) {
                        ctx.moveTo(toX(wVal), toY(l));
                        first = false;
                    } else {
                        ctx.lineTo(toX(wVal), toY(l));
                    }
                }
            }
            ctx.stroke();

            // ç»˜åˆ¶æœ€ä¼˜ç‚¹
            ctx.fillStyle = '#38ef7d';
            ctx.beginPath();
            ctx.arc(toX(1), toY(0), 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#38ef7d';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('æœ€ä¼˜ç‚¹', toX(1) + 10, toY(0) + 4);

            // ç»˜åˆ¶å†å²è½¨è¿¹
            if (history.length > 1) {
                ctx.strokeStyle = 'rgba(240, 147, 251, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(toX(history[0].w), toY(history[0].loss));
                for (let i = 1; i < history.length; i++) {
                    ctx.lineTo(toX(history[i].w), toY(history[i].loss));
                }
                ctx.stroke();
            }

            // ç»˜åˆ¶å½“å‰ç‚¹
            const currentLoss = loss(w);
            if (currentLoss <= lossMax && w >= wMin && w <= wMax) {
                ctx.fillStyle = '#f5576c';
                ctx.beginPath();
                ctx.arc(toX(w), toY(currentLoss), 8, 0, Math.PI * 2);
                ctx.fill();

                // ç»˜åˆ¶æ¢¯åº¦ç®­å¤´
                const grad = gradient(w);
                const arrowLen = Math.min(Math.abs(grad) * 10, 50);
                const arrowDir = grad > 0 ? 1 : -1;

                ctx.strokeStyle = '#ffd93d';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(toX(w), toY(currentLoss));
                ctx.lineTo(toX(w) + arrowDir * arrowLen, toY(currentLoss));
                ctx.stroke();

                // ç®­å¤´å¤´éƒ¨
                ctx.beginPath();
                ctx.moveTo(toX(w) + arrowDir * arrowLen, toY(currentLoss));
                ctx.lineTo(toX(w) + arrowDir * (arrowLen - 8), toY(currentLoss) - 5);
                ctx.lineTo(toX(w) + arrowDir * (arrowLen - 8), toY(currentLoss) + 5);
                ctx.closePath();
                ctx.fillStyle = '#ffd93d';
                ctx.fill();
            }
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const currentLoss = loss(w);
            const grad = gradient(w);

            document.getElementById('currentW').textContent = w.toFixed(4);
            document.getElementById('currentLoss').textContent = currentLoss.toFixed(4);
            document.getElementById('currentGrad').textContent = grad.toFixed(4);
            document.getElementById('currentStep').textContent = stepCount;

            drawLossCurve();
        }

        // å•æ­¥è®­ç»ƒ
        function step() {
            const lr = parseFloat(document.getElementById('lr').value);
            const grad = gradient(w);

            const oldW = w;
            w = w - lr * grad;
            stepCount++;

            history.push({ w: oldW, loss: loss(oldW) });

            // æ·»åŠ å†å²è®°å½•
            const historyEl = document.getElementById('history');
            if (stepCount === 1) {
                historyEl.innerHTML = '';
            }
            const newItem = document.createElement('div');
            newItem.className = 'history-item';
            newItem.innerHTML = `#${stepCount}: w=${oldW.toFixed(3)} â†’ ${w.toFixed(3)}, grad=${grad.toFixed(3)}`;
            historyEl.insertBefore(newItem, historyEl.firstChild);

            updateDisplay();

            // æ£€æŸ¥æ˜¯å¦æ”¶æ•›
            if (Math.abs(loss(w)) < 0.0001) {
                stopAuto();
            }
        }

        // è‡ªåŠ¨è®­ç»ƒ
        function toggleAuto() {
            if (autoRunning) {
                stopAuto();
            } else {
                startAuto();
            }
        }

        function startAuto() {
            autoRunning = true;
            document.getElementById('autoBtn').textContent = 'â¸ æš‚åœ';
            autoInterval = setInterval(() => {
                step();
                if (stepCount > 100 || Math.abs(loss(w)) < 0.0001) {
                    stopAuto();
                }
            }, 200);
        }

        function stopAuto() {
            autoRunning = false;
            document.getElementById('autoBtn').textContent = 'â© è‡ªåŠ¨';
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
            }
        }

        // é‡ç½®
        function reset() {
            stopAuto();
            w = parseFloat(document.getElementById('initW').value);
            stepCount = 0;
            history = [];
            document.getElementById('history').innerHTML = '<div style="color:#888;">è®­ç»ƒå†å²å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>';
            updateDisplay();
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('initW').addEventListener('input', function() {
            document.getElementById('initWValue').textContent = parseFloat(this.value).toFixed(1);
            if (stepCount === 0) {
                w = parseFloat(this.value);
                updateDisplay();
            }
        });

        document.getElementById('lr').addEventListener('input', function() {
            document.getElementById('lrValue').textContent = parseFloat(this.value).toFixed(2);
        });

        // åˆå§‹åŒ–
        reset();
    </script>
</body>
</html>
